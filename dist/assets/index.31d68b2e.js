import{d as e,r as t,o as a,a as n,c as r,b as o,w as s,p as l,e as i,f as d,g as c,h as v,v as f,t as u,F as g,i as m}from"./vendor.910ccf44.js";var h={name:"drag",mounted(e,t){e.setAttribute("draggable","true")}},p=e({emits:["addFile"],setup(e,r){const o=t(null),s=()=>{if(o){const e=o.value;if(e){const t=e.files;if(null==t?void 0:t.length){const e=t[0];r.emit("addFile",e)}}}},l=["drop","drgaleave","dragenter","dragover"],i=e=>{e.preventDefault()};a((()=>{const e=o.value;if(e){e.addEventListener("change",s)}l.forEach((e=>{const t=e,a=i;document.addEventListener(t,a)}))})),n((()=>{const e=o.value;if(e){e.removeEventListener("change",s)}l.forEach((e=>{const t=e,a=i;document.removeEventListener(t,a)}))}));const d=e=>{e.target.classList.remove("drag")};return{file:o,dropFile:e=>{var t;const a=null==(t=e.dataTransfer)?void 0:t.files;if(null==a?void 0:a.length){const e=a[0];r.emit("addFile",e)}else console.log("获取文件失败");d(e)},dragEnter:e=>{e.target.classList.add("drag")},dragLeave:d}}});const L=s();l("data-v-442a9cd4");const b={for:"image-load",class:"label"},w=o("div",{class:"tx"},"上传文件",-1),E={type:"file",accept:"image/*",id:"image-load",ref:"file"};i();const F=L(((e,t,a,n,s,l)=>(d(),r("div",{class:"upload-con",draggable:"true",onDrop:t[1]||(t[1]=(...t)=>e.dropFile&&e.dropFile(...t)),onDragenter:t[2]||(t[2]=(...t)=>e.dragEnter&&e.dragEnter(...t)),onDragleave:t[3]||(t[3]=(...t)=>e.dragLeave&&e.dragLeave(...t))},[o("label",b,[w,o("input",E,null,512)])],32))));function S(e){return e<1048576?(e/1024).toFixed(1)+"kb":(e/1024/1024).toFixed(1)+"mb"}p.render=F,p.__scopeId="data-v-442a9cd4";var x=e({components:{Upload:p},setup(){const e=t(""),r=t(null),o=t(""),s=t(""),l=t(""),i=t(null),d=t(null);let c,v,f=!1;const u=()=>{f=!0},g=()=>{f=!1},m=e=>{if(f){const t=(e.clientX-c)/v*100+"%";d.value.style.setProperty("--left",t)}};return a((()=>{const e=i.value,t=d.value;e&&(e.addEventListener("mousedown",u),t.addEventListener("mousemove",m),document.addEventListener("mouseup",g))})),n((()=>{const e=i.value,t=d.value;e&&(e.removeEventListener("mousedown",u),t.removeEventListener("mousemove",m),document.removeEventListener("mouseup",g))})),{getFile:t=>{const a=new FileReader;a.onload=function(){if(r&&r.value){const t=r.value;e.value=a.result,t.onload=function(){const e=d.value.getBoundingClientRect();v=e.width,c=e.left;const a=function(e,t,a){t=t||.3;var n,r,o=document.createElement("canvas"),s=o.getContext("2d"),l=document.createElement("canvas"),i=l.getContext("2d"),d=e.src.length,c=e.width,v=e.height;if((n=c*v/4e6)>1?(c/=n=Math.sqrt(n),v/=n):n=1,o.width=c,o.height=v,s.fillStyle="#fff",s.fillRect(0,0,o.width,o.height),(r=c*v/1e6)>1){var f=~~(c/(r=~~(Math.sqrt(r)+1))),u=~~(v/r);l.width=f,l.height=u;for(var g=0;g<r;g++)for(var m=0;m<r;m++)i.drawImage(e,g*f*n,m*u*n,f*n,u*n,0,0,f,u),s.drawImage(l,g*f,m*u,f,u)}else s.drawImage(e,0,0,c,v);a=a?`image/${a}`:"image/webp";var h=o.toDataURL(a,t),p=~~(100*(d-h.length)/d);return p<=0&&(a="image/jpeg",p=~~(100*(d-(h=o.toDataURL(a,t)).length)/d)),console.log("压缩前："+d),console.log("压缩后："+h.length),console.log("压缩率："+p+"%"),l.width=l.height=o.width=o.height=0,{before:{size:d},after:{size:h.length,str:h}}}(t);o.value=S(a.before.size),s.value=a.after.str,l.value=S(a.after.size)}}},a.readAsDataURL(t)},beforeImg:r,beforeSrc:e,beforeSize:o,afterSrc:s,afterSize:l,moveLine:i,handleLine:e=>{},showBox:d}}});const z=s();l("data-v-30a21f74");const D={class:"con"},I={class:"img-show",style:{"--left":"50%"},ref:"showBox"},R={class:"before"},y={class:"line",ref:"moveLine"},U={class:"after"};i();const A=z(((e,t,a,n,s,l)=>{const i=c("Upload");return d(),r(g,null,[o(i,{onAddFile:e.getFile},null,8,["onAddFile"]),o("div",D,[o("div",I,[o("div",R,[o("img",{src:e.beforeSrc,alt:"",ref:"beforeImg"},null,8,["src"]),v(o("div",{class:"before-text"}," 压缩前"+u(e.beforeSize),513),[[f,e.beforeSrc]])]),o("div",y,null,512),o("div",U,[v(o("div",{class:"after-text"}," 压缩后"+u(e.afterSize),513),[[f,e.afterSrc]]),o("img",{src:e.afterSrc,alt:""},null,8,["src"])])],512)])],64)}));x.render=A,x.__scopeId="data-v-30a21f74";const _=m(x);_.directive(h.name,h),_.mount("#app");
